; Simple x86-64 linux assembly library written as part of learning assembly

; File descriptors
STDIN_FILENO equ 0
STDOUT_FILENO equ 1
STDERR_FILENO equ 2

; System calls according to https://x64.syscall.sh/
sys_read equ 0x0
sys_write equ 0x1
sys_open equ 0x2
sys_close equ 0x3
sys_stat equ 0x4
sys_fstat equ 0x5
sys_lstat equ 0x6
sys_poll equ 0x7
sys_lseek equ 0x8
sys_mmap equ 0x9
sys_mprotect equ 0xA
sys_munmap equ 0xB
sys_brk equ 0xC
sys_rt_sigaction equ 0xD
sys_rt_sigprocmask equ 0xE
sys_rt_sigreturn equ 0xF
sys_ioctl equ 0x10
sys_pread64 equ 0x11
sys_pwrite64 equ 0x12
sys_readv equ 0x13
sys_writev equ 0x14
sys_access equ 0x15
sys_pipe equ 0x16
sys_select equ 0x17
sys_sched_yield equ 0x18
sys_mremap equ 0x19
sys_msync equ 0x1A
sys_mincore equ 0x1B
sys_madvise equ 0x1C
sys_shmget equ 0x1D
sys_shmat equ 0x1E
sys_shmctl equ 0x1F
sys_dup equ 0x20
sys_dup2 equ 0x21
sys_pause equ 0x22
sys_nanosleep equ 0x23
sys_getitimer equ 0x24
sys_alarm equ 0x25
sys_setitimer equ 0x26
sys_getpid equ 0x27
sys_sendfile equ 0x28
sys_socket equ 0x29
sys_connect equ 0x2A
sys_accept equ 0x2B
sys_sendto equ 0x2C
sys_recvfrom equ 0x2D
sys_sendmsg equ 0x2E
sys_recvmsg equ 0x2F
sys_shutdown equ 0x30
sys_bind equ 0x31
sys_listen equ 0x32
sys_getsockname equ 0x33
sys_getpeername equ 0x34
sys_socketpair equ 0x35
sys_setsockopt equ 0x36
sys_getsockopt equ 0x37
sys_clone equ 0x38
sys_fork equ 0x39
sys_vfork equ 0x3A
sys_execve equ 0x3B
sys_exit equ 0x3C
sys_wait4 equ 0x3D
sys_kill equ 0x3E
sys_uname equ 0x3F
sys_semget equ 0x40
sys_semop equ 0x41
sys_semctl equ 0x42
sys_shmdt equ 0x43
sys_msgget equ 0x44
sys_msgsnd equ 0x45
sys_msgrcv equ 0x46
sys_msgctl equ 0x47
sys_fcntl equ 0x48
sys_flock equ 0x49
sys_fsync equ 0x4A
sys_fdatasync equ 0x4B
sys_truncate equ 0x4C
sys_ftruncate equ 0x4D
sys_getdents equ 0x4E
sys_getcwd equ 0x4F
sys_chdir equ 0x50
sys_fchdir equ 0x51
sys_rename equ 0x52
sys_mkdir equ 0x53
sys_rmdir equ 0x54
sys_creat equ 0x55
sys_link equ 0x56
sys_unlink equ 0x57
sys_symlink equ 0x58
sys_readlink equ 0x59
sys_chmod equ 0x5A
sys_fchmod equ 0x5B
sys_chown equ 0x5C
sys_fchown equ 0x5D
sys_lchown equ 0x5E
sys_umask equ 0x5F
sys_gettimeofday equ 0x60
sys_getrlimit equ 0x61
sys_getrusage equ 0x62
sys_sysinfo equ 0x63
sys_times equ 0x64
sys_ptrace equ 0x65
sys_getuid equ 0x66
sys_syslog equ 0x67
sys_getgid equ 0x68
sys_setuid equ 0x69
sys_setgid equ 0x6A
sys_geteuid equ 0x6B
sys_getegid equ 0x6C
sys_setpgid equ 0x6D
sys_getppid equ 0x6E
sys_getpgrp equ 0x6F
sys_setsid equ 0x70
sys_setreuid equ 0x71
sys_setregid equ 0x72
sys_getgroups equ 0x73
sys_setgroups equ 0x74
sys_setresuid equ 0x75
sys_getresuid equ 0x76
sys_setresgid equ 0x77
sys_getresgid equ 0x78
sys_getpgid equ 0x79
sys_setfsuid equ 0x7A
sys_setfsgid equ 0x7B
sys_getsid equ 0x7C
sys_capget equ 0x7D
sys_capset equ 0x7E
sys_rt_sigpending equ 0x7F
sys_rt_sigtimedwait equ 0x80
sys_rt_sigqueueinfo equ 0x81
sys_rt_sigsuspend equ 0x82
sys_sigaltstack equ 0x83
sys_utime equ 0x84
sys_mknod equ 0x85
sys_uselib equ 0x86
sys_personality equ 0x87
sys_ustat equ 0x88
sys_statfs equ 0x89
sys_fstatfs equ 0x8A
sys_sysfs equ 0x8B
sys_getpriority equ 0x8C
sys_setpriority equ 0x8D
sys_sched_setparam equ 0x8E
sys_sched_getparam equ 0x8F
sys_sched_setscheduler equ 0x90
sys_sched_getscheduler equ 0x91
sys_sched_get_priority_max equ 0x92
sys_sched_get_priority_min equ 0x93
sys_sched_rr_get_interval equ 0x94
sys_mlock equ 0x95
sys_munlock equ 0x96
sys_mlockall equ 0x97
sys_munlockall equ 0x98
sys_vhangup equ 0x99
sys_modify_ldt equ 0x9A
sys_pivot_root equ 0x9B
sys__sysctl equ 0x9C
sys_prctl equ 0x9D
sys_arch_prctl equ 0x9E
sys_adjtimex equ 0x9F
sys_setrlimit equ 0xA0
sys_chroot equ 0xA1
sys_sync equ 0xA2
sys_acct equ 0xA3
sys_settimeofday equ 0xA4
sys_mount equ 0xA5
sys_umount2 equ 0xA6
sys_swapon equ 0xA7
sys_swapoff equ 0xA8
sys_reboot equ 0xA9
sys_sethostname equ 0xAA
sys_setdomainname equ 0xAB
sys_iopl equ 0xAC
sys_ioperm equ 0xAD
sys_create_module equ 0xAE
sys_init_module equ 0xAF
sys_delete_module equ 0xB0
sys_get_kernel_syms equ 0xB1
sys_query_module equ 0xB2
sys_quotactl equ 0xB3
sys_nfsservctl equ 0xB4
sys_getpmsg equ 0xB5
sys_putpmsg equ 0xB6
sys_afs_syscall equ 0xB7
sys_tuxcall equ 0xB8
sys_security equ 0xB9
sys_gettid equ 0xBA
sys_readahead equ 0xBB
sys_setxattr equ 0xBC
sys_lsetxattr equ 0xBD
sys_fsetxattr equ 0xBE
sys_getxattr equ 0xBF
sys_lgetxattr equ 0xC0
sys_fgetxattr equ 0xC1
sys_listxattr equ 0xC2
sys_llistxattr equ 0xC3
sys_flistxattr equ 0xC4
sys_removexattr equ 0xC5
sys_lremovexattr equ 0xC6
sys_fremovexattr equ 0xC7
sys_tkill equ 0xC8
sys_time equ 0xC9
sys_futex equ 0xCA
sys_sched_setaffinity equ 0xCB
sys_sched_getaffinity equ 0xCC
sys_set_thread_area equ 0xCD
sys_io_setup equ 0xCE
sys_io_destroy equ 0xCF
sys_io_getevents equ 0xD0
sys_io_submit equ 0xD1
sys_io_cancel equ 0xD2
sys_get_thread_area equ 0xD3
sys_lookup_dcookie equ 0xD4
sys_epoll_create equ 0xD5
sys_epoll_ctl_old equ 0xD6
sys_epoll_wait_old equ 0xD7
sys_remap_file_pages equ 0xD8
sys_getdents64 equ 0xD9
sys_set_tid_address equ 0xDA
sys_restart_syscall equ 0xDB
sys_semtimedop equ 0xDC
sys_fadvise64 equ 0xDD
sys_timer_create equ 0xDE
sys_timer_settime equ 0xDF
sys_timer_gettime equ 0xE0
sys_timer_getoverrun equ 0xE1
sys_timer_delete equ 0xE2
sys_clock_settime equ 0xE3
sys_clock_gettime equ 0xE4
sys_clock_getres equ 0xE5
sys_clock_nanosleep equ 0xE6
sys_exit_group equ 0xE7
sys_epoll_wait equ 0xE8
sys_epoll_ctl equ 0xE9
sys_tgkill equ 0xEA
sys_utimes equ 0xEB
sys_vserver equ 0xEC
sys_mbind equ 0xED
sys_set_mempolicy equ 0xEE
sys_get_mempolicy equ 0xEF
sys_mq_open equ 0xF0
sys_mq_unlink equ 0xF1
sys_mq_timedsend equ 0xF2
sys_mq_timedreceive equ 0xF3
sys_mq_notify equ 0xF4
sys_mq_getsetattr equ 0xF5
sys_kexec_load equ 0xF6
sys_waitid equ 0xF7
sys_add_key equ 0xF8
sys_request_key equ 0xF9
sys_keyctl equ 0xFA
sys_ioprio_set equ 0xFB
sys_ioprio_get equ 0xFC
sys_inotify_init equ 0xFD
sys_inotify_add_watch equ 0xFE
sys_inotify_rm_watch equ 0xFF
sys_migrate_pages equ 0x100
sys_openat equ 0x101
sys_mkdirat equ 0x102
sys_mknodat equ 0x103
sys_fchownat equ 0x104
sys_futimesat equ 0x105
sys_newfstatat equ 0x106
sys_unlinkat equ 0x107
sys_renameat equ 0x108
sys_linkat equ 0x109
sys_symlinkat equ 0x10A
sys_readlinkat equ 0x10B
sys_fchmodat equ 0x10C
sys_faccessat equ 0x10D
sys_pselect6 equ 0x10E
sys_ppoll equ 0x10F
sys_unshare equ 0x110
sys_set_robust_list equ 0x111
sys_get_robust_list equ 0x112
sys_splice equ 0x113
sys_tee equ 0x114
sys_sync_file_range equ 0x115
sys_vmsplice equ 0x116
sys_move_pages equ 0x117
sys_utimensat equ 0x118
sys_epoll_pwait equ 0x119
sys_signalfd equ 0x11A
sys_timerfd_create equ 0x11B
sys_eventfd equ 0x11C
sys_fallocate equ 0x11D
sys_timerfd_settime equ 0x11E
sys_timerfd_gettime equ 0x11F
sys_accept4 equ 0x120
sys_signalfd4 equ 0x121
sys_eventfd2 equ 0x122
sys_epoll_create1 equ 0x123
sys_dup3 equ 0x124
sys_pipe2 equ 0x125
sys_inotify_init1 equ 0x126
sys_preadv equ 0x127
sys_pwritev equ 0x128
sys_rt_tgsigqueueinfo equ 0x129
sys_perf_event_open equ 0x12A
sys_recvmmsg equ 0x12B
sys_fanotify_init equ 0x12C
sys_fanotify_mark equ 0x12D
sys_prlimit64 equ 0x12E
sys_name_to_handle_at equ 0x12F
sys_open_by_handle_at equ 0x130
sys_clock_adjtime equ 0x131
sys_syncfs equ 0x132
sys_sendmmsg equ 0x133
sys_setns equ 0x134
sys_getcpu equ 0x135
sys_process_vm_readv equ 0x136
sys_process_vm_writev equ 0x137
sys_kcmp equ 0x138
sys_finit_module equ 0x139
sys_sched_setattr equ 0x13A
sys_sched_getattr equ 0x13B
sys_renameat2 equ 0x13C
sys_seccomp equ 0x13D
sys_getrandom equ 0x13E
sys_memfd_create equ 0x13F
sys_kexec_file_load equ 0x140
sys_bpf equ 0x141
sys_execveat equ 0x142
sys_userfaultfd equ 0x143
sys_membarrier equ 0x144
sys_mlock2 equ 0x145
sys_copy_file_range equ 0x146
sys_preadv2 equ 0x147
sys_pwritev2 equ 0x148
sys_pkey_mprotect equ 0x149
sys_pkey_alloc equ 0x14A
sys_pkey_free equ 0x14B
sys_statx equ 0x14C

; Some standard ASCII table characters
NULL equ 0x0
BEL equ 0x7
LF equ 0xA
CR equ 0xD

section .bss
    res_c resb 1

%macro putc 2
    mov rcx, %1
    mov [res_c], rcx
    mov rax, sys_write
    mov rdi, %2
    mov rsi, res_c
    mov rdx, 1
    syscall
%endmacro

%macro putchar 1
    putc %1, STDOUT_FILENO
%endmacro

%macro exit 1
    mov rax, sys_exit
    mov rdi, %1
    syscall
%endmacro

%macro abort 0
    exit 0
%endmacro